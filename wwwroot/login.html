<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Đăng nhập</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
/* RESET */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* BODY & BACKGROUND */
body {
  font-family: 'Inter', sans-serif;
  background: #ffffff;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}
body::before {
  content: '';
  position: absolute;
  top: -50%;
  right: -30%;
  width: 900px;
  height: 900px;
  background: #00D4FF;
  border-radius: 50%;
  opacity: 0.4;
  z-index: 1;
}
body::after {
  content: '';
  position: absolute;
  bottom: -40%;
  left: -20%;
  width: 700px;
  height: 700px;
  background: #4F46E5;
  border-radius: 50%;
  z-index: 1;
}

/* LOGIN BOX */
.login-box {
  background: white;
  padding: 60px 50px;
  border-radius: 32px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.12);
  width: 100%;
  max-width: 420px;
  text-align: center;
  position: relative;
  z-index: 10;
}

/* LOGO */
.logo {
  width: 80px;
  height: 80px;
  background: #4F46E5;
  border-radius: 50%;
  margin: 0 auto 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 10px 30px rgba(79,70,229,0.4);
}
.logo i {
  color: white;
  font-size: 38px;
}

/* TITLE */
h1 {
  font-size: 36px;
  font-weight: 700;
  color: #111111;
  margin-bottom: 50px;
}

/* INPUTS */
.input-group {
  position: relative;
  margin-bottom: 24px;
}
.input-group input {
  width: 100%;
  padding: 18px 20px 18px 54px;
  border: 1px solid #E2E8F0;
  border-radius: 16px;
  font-size: 16px;
  background: #F8FAFC;
  transition: all 0.3s;
}
.input-group input:focus {
  outline: none;
  border-color: #4F46E5;
  background: white;
  box-shadow: 0 0 0 4px rgba(79,70,229,0.1);
}
.input-group i {
  position: absolute;
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
  color: #94A3B8;
  font-size: 18px;
}

/* BUTTON */
button {
  width: 100%;
  padding: 18px;
  background: #4F46E5;
  color: white;
  border: none;
  border-radius: 16px;
  font-size: 17px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 10px 30px rgba(79,70,229,0.35);
  margin-top: 10px;
}
button:hover {
  background: #4338CA;
  transform: translateY(-3px);
  box-shadow: 0 15px 35px rgba(79,70,229,0.45);
}

/* MESSAGE */
.message {
  margin-top: 20px;
  padding: 14px;
  border-radius: 12px;
  font-size: 15px;
  font-weight: 500;
}
.error {
  background: #FEF2F2;
  color: #DC2626;
  border: 1px solid #FECACA;
}
.success {
  background: #ECFDF5;
  color: #059669;
  border: 1px solid #86EFAC;
}
</style>
</head>
<body>

<div class="login-box">
  <div class="logo"><i class="fas fa-user-circle"></i></div>
  <h1>Login</h1>

  <form id="loginForm">
    <div class="input-group">
      <i class="fas fa-envelope"></i>
      <input type="email" id="email" required placeholder="Email">
    </div>
    <div class="input-group">
      <i class="fas fa-lock"></i>
      <input type="password" id="password" required placeholder="Password">
    </div>
    <button type="submit">Login</button>
  </form>
  <div id="message"></div>
</div>

<script>
// ĐỔI DÒNG NÀY THEO PORT BACKEND 
const API_URL = "https://localhost:5058/api";

function showMsg(text, type = "error") {
  const msg = document.getElementById('message');
  msg.innerHTML = `<div class="message ${type}">${text}</div>`;
  setTimeout(() => msg.innerHTML = "", 5000);
}

document.getElementById("loginForm").onsubmit = async function(e) {
  e.preventDefault();

  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;

  if (!email || !password) {
    showMsg("Vui lòng nhập đầy đủ email và mật khẩu");
    return;
  }

  try {
    const res = await fetch(`${API_URL}/auth/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    if (!res.ok) {
      const error = await res.json().catch(() => ({}));
      throw new Error(error.message || error.title || "Email hoặc mật khẩu không đúng");
    }

    const data = await res.json();
    const token = data.token || data.accessToken || data.access_token;
    if (!token) throw new Error("Không nhận được token từ server");

    localStorage.setItem("token", token);
    localStorage.setItem("userEmail", email);

    showMsg("Đăng nhập thành công! Đang chuyển hướng...", "success");

    setTimeout(() => {
      const role = (data.role || data.user?.role || data.Role || "").toLowerCase();
      if (role.includes("admin")) {
        location.href = "admin.html";
      } else {
        location.href = "order.html";
      }
    }, 1200);

  } catch (err) {
    showMsg(err.message || "Đã có lỗi xảy ra, vui lòng thử lại");
  }
};
</script>
</body>
</html>
